$(function(){L.mapbox.accessToken="pk.eyJ1IjoiYW9zaWthIiwiYSI6IjQzRGIxeEkifQ.7OvmyBbXwwt9Qxjlh9Qd3w";var e=L.mapbox.map("map","examples.map-i86nkdio",{zoomControl:!1});$(".map-bar__toggle").on("click",function(a){a.preventDefault,$(".container").hasClass("hide-des")?($(this).html("Expand Map"),$(".container").removeClass("hide-des"),e.invalidateSize()):($(this).html("Expand Description"),$(".container").addClass("hide-des"),$(".narrative").addClass("slide-down"),e.invalidateSize())}),e.scrollWheelZoom.disable();var a,o,t,n,i,r;a=$("body"),o=$("#map"),t=$(".topbar"),$.getJSON("src/data/destinations.json",function(s){var l=$("#itemTemplate").html(),c=Handlebars.compile(l),d=c(s);$(".panels-container").html(d),n=$(".narrative"),i=$(".panel"),r="",$.getJSON("src/data/data.geojson",function(a){function o(a){if(a!==r){s.eachLayer(function(o){feature=o.feature,o.feature.properties.id===a?(feature.properties.icon.iconUrl="src/images/pagoda-highlight.png",e.setView(o.getLatLng(),o.feature.properties.zoom||14),o.setIcon(L.icon(feature.properties.icon))):(feature.properties.icon.iconUrl="src/images/pagoda.png",o.setIcon(L.icon(feature.properties.icon)))});for(var o=0;o<i.length;o++)i[o].id===a?$(i[o]).addClass("active"):$(i[o]).removeClass("active");r=a}}function t(e,a,o){var t;return function(){var n=this,i=arguments,r=function(){t=null,o||e.apply(n,i)},s=o&&!t;clearTimeout(t),t=setTimeout(r,a),s&&e.apply(n,i)}}L.control.zoomslider().addTo(e);var s=L.mapbox.featureLayer(a).addTo(e);s.eachLayer(function(e){e.on("click",function(){o(this.feature.properties.id);var e=$(".active");$("html, body").animate({scrollTop:e.offset().top-50})})}),o("cover");var l=t(function(){for(var e=(n.height(),r),a=i.length-1;a>=0;a--){var t=$(i[a]),s=t.offset();s.top>=$(window).scrollTop()-250&&(e=i[a].id)}o(e)},150);$(window).on("scroll",function(){l()})});var p,f,u;p=$(".js__info-open"),f=$(".info-overlay"),u=$(".js__info-close"),p.on("click",function(e){e.preventDefault(),a.css("overflow","hidden"),f.fadeIn(0),o.addClass("blur"),t.addClass("blur"),n.addClass("blur")}),u.on("click",function(e){e.preventDefault(),a.css("overflow","auto"),f.fadeOut(0),o.removeClass("blur"),t.removeClass("blur"),n.removeClass("blur")})})});