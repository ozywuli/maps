$(function(){L.mapbox.accessToken="pk.eyJ1IjoiYW9zaWthIiwiYSI6IjQzRGIxeEkifQ.7OvmyBbXwwt9Qxjlh9Qd3w";var e=L.mapbox.map("map","examples.map-i86nkdio",{zoomControl:!1});e.scrollWheelZoom.disable();var o,a,t,r,n,i;o=$("body"),a=$("#map"),t=$(".topbar"),$.getJSON("src/data/destinations.json",function(s){var l=$("#itemTemplate").html(),c=Handlebars.compile(l),p=c(s);$(".panels-container").html(p),r=$(".narrative"),n=$(".panel"),i="",$.getJSON("src/data/data.geojson",function(o){function a(o){if(o!==i){s.eachLayer(function(a){feature=a.feature,a.feature.properties.id===o?(feature.properties.icon.iconUrl="src/images/pagoda-highlight.png",e.setView(a.getLatLng(),a.feature.properties.zoom||14),a.setIcon(L.icon(feature.properties.icon))):(feature.properties.icon.iconUrl="src/images/pagoda.png",a.setIcon(L.icon(feature.properties.icon)))});for(var a=0;a<n.length;a++)n[a].id===o?$(n[a]).addClass("active"):$(n[a]).removeClass("active");i=o}}function t(e,o,a){var t;return function(){var r=this,n=arguments,i=function(){t=null,a||e.apply(r,n)},s=a&&!t;clearTimeout(t),t=setTimeout(i,o),s&&e.apply(r,n)}}L.control.zoomslider().addTo(e);var s=L.mapbox.featureLayer(o).addTo(e);s.eachLayer(function(e){e.on("click",function(){a(this.feature.properties.id);var e=$(".active");$("html, body").animate({scrollTop:e.offset().top-50})})}),a("cover");var l=t(function(){for(var e=(r.height(),i),o=n.length-1;o>=0;o--){var t=$(n[o]),s=t.offset();s.top>=$(window).scrollTop()-250&&(e=n[o].id)}a(e)},150);$(window).on("scroll",function(){l()})});var f,u,d;f=$(".js__info-open"),u=$(".info-overlay"),d=$(".js__info-close"),f.on("click",function(e){e.preventDefault(),o.css("overflow","hidden"),u.fadeIn(0),a.addClass("blur"),t.addClass("blur"),r.addClass("blur")}),d.on("click",function(e){e.preventDefault(),o.css("overflow","auto"),u.fadeOut(0),a.removeClass("blur"),t.removeClass("blur"),r.removeClass("blur")})})});